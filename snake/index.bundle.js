(()=>{"use strict";function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var t=function(){function t(){var e,n,i;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),e=this,n="_element",i=document.createElement("div"),n in e?Object.defineProperty(e,n,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[n]=i}var n,i;return n=t,(i=[{key:"element",get:function(){return this._element}},{key:"entity",get:function(){return this._entity},set:function(e){this._entity=e,this._element.className=e?e.className:void 0}}])&&e(n.prototype,i),t}();function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var o=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:30,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20;n(this,e),r(this,"_container",document.createElement("div")),r(this,"_width",0),r(this,"_height",0),r(this,"_tiles",[]),r(this,"_entities",new Map),this._container.className="snake-game",this.setDimensions(t,i)}var o,a;return o=e,(a=[{key:"setDimensions",value:function(e,n){var i=e*n;if(i>this._tiles.length)for(var r=this._tiles.length;r<i;r++){var o=new t;this._tiles.push(o),this._container.appendChild(o.element)}else if(i<this._tiles.length)for(var a=this._tiles.length;a>i;a--)this._container.removeChild(this._tiles.pop().element);this._width=e,this._height=n,this._container.style["grid-template-columns"]="repeat(".concat(this._width,", 1fr)")}},{key:"addEntity",value:function(e,t,n){var i=n*this._width+t;this._tiles[i].entity&&this.removeEntity(this._tiles[i].entity),this._tiles[i].entity=e,this._entities.set(e,i)}},{key:"getEntity",value:function(e,t){return this._tiles[t*this._width+e].entity}},{key:"removeEntity",value:function(e){if(this._entities.has(e)){var t=this._entities.get(e);this._tiles[t].entity=void 0,this._entities.delete(e)}}},{key:"clearEntities",value:function(){var e=this;this._entities.forEach((function(t){return e._tiles[t].entity=void 0})),this._entities.clear()}},{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}},{key:"element",get:function(){return this._container}}])&&i(o.prototype,a),e}();function a(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var s=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._className=t}var t,n;return t=e,(n=[{key:"consumed",value:function(e){return!1}},{key:"className",get:function(){return this._className}}])&&a(t.prototype,n),e}();function u(e){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function c(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function h(e,t){return!t||"object"!==u(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function f(e){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var d=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}(a,e);var t,n,i,r,o=(i=a,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=f(i);if(r){var n=f(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return h(this,e)});function a(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),o.call(this,"snake-piece")}return t=a,(n=[{key:"consumed",value:function(e){return!0}}])&&c(t.prototype,n),a}(s);function v(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function p(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var m=[[0,-1],[1,0],[0,1],[-1,0]],y=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),p(this,"_tileMap",void 0),p(this,"_pieces",[]),p(this,"_headX",void 0),p(this,"_headY",void 0),p(this,"_direction",void 0),p(this,"_lastMovementDirection",void 0),p(this,"_movementInterval",void 0),p(this,"_movementHandler",this.move.bind(this)),p(this,"_movementTimeout",200),p(this,"_grow",0),this._tileMap=t}var t,n;return t=e,(n=[{key:"onDeath",value:function(){}},{key:"respawn",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:5;0!==this.length&&this.destroy();for(var i=0;i<n;i++){var r=new d;this._pieces.push(r),this._tileMap.addEntity(r,e-i,t)}this._headX=e,this._headY=t,this._direction=1,this._lastMovementDirection=1}},{key:"destroy",value:function(){for(var e in this.pause(),this._pieces)this._tileMap.removeEntity(e);this._pieces.splice(0),this._grow=0,this._headX=void 0,this._headY=void 0,this._direction=void 0,this._lastMovementDirection=void 0}},{key:"resume",value:function(){if(0===this._pieces.length)throw new Error("Can't resume the snake's movement while it's not in existance (respawn it first).");void 0!==this._movementInterval&&this.pause(),this._tileMap.addEntity(this._pieces[0],this._headX,this._headY),this._movementInterval=setInterval(this._movementHandler,this._movementTimeout)}},{key:"pause",value:function(){void 0!==this._movementInterval&&(clearInterval(this._movementInterval),this._movementInterval=void 0)}},{key:"die",value:function(){this.pause(),this.onDeath()}},{key:"grow",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this._grow+=e}},{key:"move",value:function(){var e;this._lastMovementDirection=this._direction,this._grow>0?(e=new d,this._grow--):(e=this._pieces.pop(),this._tileMap.removeEntity(e)),this._pieces.unshift(e);var t=m[this._direction],n=t[0],i=t[1];this._headX+=n,this._headY+=i,this._headX<0&&(this._headX=this._tileMap.width-1),this._headY<0&&(this._headY=this._tileMap.height-1),this._headX%=this._tileMap.width,this._headY%=this._tileMap.height;var r=this._tileMap.getEntity(this._headX,this._headY);r&&r.consumed(this)?this.die():this._tileMap.addEntity(e,this._headX,this._headY)}},{key:"length",get:function(){return this._pieces.length}},{key:"spawned",get:function(){return 0!==this._pieces.length}},{key:"paused",get:function(){return void 0===this._movementInterval}},{key:"direction",get:function(){return this._lastMovementDirection},set:function(e){(this._lastMovementDirection+e)%2==1&&(this._direction=e)}}])&&v(t.prototype,n),e}();function _(e){return(_="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function b(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function g(e,t){return(g=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function w(e,t){return!t||"object"!==_(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function k(e){return(k=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var E=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&g(e,t)}(a,e);var t,n,i,r,o=(i=a,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=k(i);if(r){var n=k(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return w(this,e)});function a(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),o.call(this,"fruit")}return t=a,(n=[{key:"onConsumtion",value:function(){}},{key:"consumed",value:function(e){return this.onConsumtion(),e.grow(),!1}}])&&b(t.prototype,n),a}(s);function M(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function S(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function O(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var j=function(){function e(t,n){var i=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:5,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5;M(this,e),O(this,"startingSnakeLength",void 0),O(this,"_tileMap",void 0),O(this,"_fruitsCount",void 0),O(this,"_snake",void 0),O(this,"_fruitConsumtionHandler",void 0),this._tileMap=new o(t,n),this._fruitsCount=r,this.startingSnakeLength=a,this._snake=new y(this._tileMap),this._snake.onDeath=function(){return i.onDeath()},this._fruitConsumtionHandler=function(){i.spawnFruit(),i.onFruitConsumed()}}var t,n;return t=e,(n=[{key:"onDeath",value:function(){}},{key:"onFruitConsumed",value:function(){}},{key:"start",value:function(){this.setup(),this.resume()}},{key:"pause",value:function(){this._snake.pause()}},{key:"resume",value:function(){if(!this._snake.spawned)throw new Error("The snake is not spawned for the game to resume, call .setup() first before resuming the game.");this._snake.resume()}},{key:"setup",value:function(){this._snake.spawned&&this.reset(),this.spawnSnake(),this.spawnStartingFruits()}},{key:"reset",value:function(){this._snake.destroy(),this._tileMap.clearEntities()}},{key:"spawnSnake",value:function(){this._snake.respawn(Math.floor((this._tileMap.width+this.startingSnakeLength)/2),Math.floor(this._tileMap.height/2),this.startingSnakeLength)}},{key:"spawnStartingFruits",value:function(){for(var e=0;e<this._fruitsCount;e++)this.spawnFruit()}},{key:"spawnFruit",value:function(){var e=Math.floor(Math.random()*this.tileMap.width),t=Math.floor(Math.random()*this.tileMap.height);if(this.tileMap.getEntity(e,t))this.spawnFruit();else{var n=new E;n.onConsumtion=this._fruitConsumtionHandler,this.tileMap.addEntity(n,e,t)}}},{key:"element",get:function(){return this._tileMap.element}},{key:"tileMap",get:function(){return this._tileMap}},{key:"snake",get:function(){return this._snake}}])&&S(t.prototype,n),e}();function C(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var D={ArrowUp:0,ArrowRight:1,ArrowDown:2,ArrowLeft:3,w:0,W:0,d:1,D:1,s:2,S:2,a:3,A:3},P=function(){function e(t){var n,i;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),i=void 0,(n="_snake")in this?Object.defineProperty(this,n,{value:i,enumerable:!0,configurable:!0,writable:!0}):this[n]=i,this._snake=t,document.addEventListener("keydown",this.onkeydown.bind(this))}var t,n;return t=e,(n=[{key:"onkeydown",value:function(e){!this._snake.paused&&e.key in D&&(this._snake.direction=D[e.key])}}])&&C(t.prototype,n),e}();function T(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function L(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var I=function(){function e(){var t=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),L(this,"_gamepads",{}),L(this,"_gamepadZone",.8),window.addEventListener("gamepadconnected",(function(e){var n=e.gamepad;console.log("Gamepad Connected",n),t._gamepads[n.id]=n})),window.addEventListener("gamepaddisconnected",(function(e){var n=e.gamepad;console.log("Gamepad Disconnected",n),delete t._gamepads[n.id]})),requestAnimationFrame((function e(n){t.updateControllers(),requestAnimationFrame(e)}))}var t,n;return t=e,(n=[{key:"updateControllers",value:function(){for(var e in this._gamepads){var t=this._gamepads[e],n=t.axes[0],i=t.axes[1];n>this._gamepadZone?this.emulateKeyboardButton("ArrowRight"):n<-this._gamepadZone&&this.emulateKeyboardButton("ArrowLeft"),i>this._gamepadZone?this.emulateKeyboardButton("ArrowDown"):i<-this._gamepadZone&&this.emulateKeyboardButton("ArrowUp")}}},{key:"emulateKeyboardButton",value:function(e){document.dispatchEvent(new KeyboardEvent("keydown",{key:e})),document.dispatchEvent(new KeyboardEvent("keyup",{key:e}))}}])&&T(t.prototype,n),e}();function q(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function R(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var F=document.querySelector(".game-bar .buttons-container .icon-reload"),A=document.querySelector(".game-bar .buttons-container .icon-fullscreen"),x=document.querySelector(".game-bar .buttons-container .icon-pause"),X=new j(30,20),Y=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),R(this,"_timer",0),R(this,"_timerInterval",void 0),R(this,"_timerTimeout",200)}var t,n;return t=e,(n=[{key:"start",value:function(){this.reset(),this.resume()}},{key:"resume",value:function(){void 0===this._timerInterval&&(this._timerInterval=setInterval(this.tick.bind(this),this._timerTimeout))}},{key:"pause",value:function(){void 0!==this._timerInterval&&(clearInterval(this._timerInterval),this._timerInterval=void 0)}},{key:"stop",value:function(){this.pause()}},{key:"reset",value:function(){this._timer=0,this.updateDisplay()}},{key:"tick",value:function(){this._timer+=this._timerTimeout/1e3,this.updateDisplay()}},{key:"formatDisplay",value:function(){var e=Math.floor(this._timer%60).toString(),t=Math.floor(this._timer/60).toString();return 1===e.length&&(e="0"+e),1===t.length&&(t="0"+t),t+":"+e}},{key:"updateDisplay",value:function(){document.querySelector(".timer-value").innerHTML=this.formatDisplay()}}])&&q(t.prototype,n),e}());function H(e){document.querySelector(".score-value").innerHTML=(X.snake.length+(e?1:0)).toString()}function K(){document.querySelector(".game-over").classList.remove("active"),X.start(),Y.start(),Y.updateDisplay(),H(),document.querySelector(".game-paused.active")&&(X.pause(),Y.pause())}X.onFruitConsumed=function(){return H(!0)},X.onDeath=function(){var e;Y.stop(),e=document.querySelector(".game-over"),document.querySelector(".game-over .score").innerHTML="<b>Score:</b> ".concat(X.snake.length.toString()," - <b>Time:</b> ").concat(Y.formatDisplay()),e.classList.add("active")},new P(X.snake),new I;var B=document.querySelector(".game-container");B.insertBefore(X.element,B.firstChild),document.fullscreenEnabled&&A.removeAttribute("disabled"),document.onfullscreenchange=function(){document.fullscreenElement?(A.classList.remove("icon-fullscreen"),A.classList.add("icon-fullscreen-exit")):(A.classList.remove("icon-fullscreen-exit"),A.classList.add("icon-fullscreen"))},F.onclick=function(){X.reset(),setTimeout(K,200)},A.onclick=function(){document.fullscreenElement?document.exitFullscreen():document.querySelector("html").requestFullscreen()},x.onclick=function(){document.querySelector(".game-paused").classList.toggle("active")?(x.classList.remove("icon-pause"),setTimeout((function(){return x.classList.add("icon-play")}),50),X.pause(),Y.pause()):(x.classList.remove("icon-play"),setTimeout((function(){return x.classList.add("icon-pause")}),50),X.resume(),Y.resume())},document.querySelector(".restart").onclick=K,K()})();